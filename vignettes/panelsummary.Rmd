---
title: "panelsummary: regression tables with stacked models"
output: pdf_document
---


# `panelsummary`

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
#| message = FALSE
library(kableExtra)
library(modelsummary)
library(fixest)
library(lme4)
```

```{css, echo=FALSE}
tbody {
  font-size: .8em;
}
thead {
  font-size: .8em;
}
```


## Simple example examples

We want to present 4 different models, half of which are estimated using a different outcome variable. When using `modelsummary`, we store models in a list. When useing `panelsummary`, we store models in a list of lists:

```{r}
library(modelsummary)

panels <- list(
    list(
        lm(mpg ~ drat, data = mtcars),
        lm(mpg ~ drat + qsec, data = mtcars)
    ),
    list(
        lm(hp ~ drat, data = mtcars),
        lm(hp ~ drat + qsec, data = mtcars)
    )
)

panelsummary(panels, gof_map = "nobs")
```

We can can name the models and the panels by supplying a named nested list:

```{r}
panels <- list(
    "Outcome: mpg" = list(
        "One" = lm(mpg ~ drat, data = mtcars),
        "Two" = lm(mpg ~ drat + qsec, data = mtcars)
    ),
    "Outcome: hp" = list(
        "One" = lm(hp ~ drat, data = mtcars),
        "Two" = lm(hp ~ drat + qsec, data = mtcars)
    )
)
pkgload::load_all()
panelsummary(panels, gof_map = c("r.squared", "nobs"))
```


## Non-matching names

```{r}
panels <- list(
    "Outcome: mpg" = list(
        "One" = lm(mpg ~ drat, data = mtcars),
        "Two" = lm(mpg ~ drat + qsec, data = mtcars)
    ),
    "Outcome: hp" = list(
        "One" = lm(hp ~ drat, data = mtcars),
        "Three" = lm(hp ~ drat + qsec, data = mtcars)
    )
)
panelsummary(panels, gof_map = "nobs")
```



```{r}
panels <- list(
    "Panel A: MPG" = list(
        feols(mpg ~  cyl | gear + carb, cluster = ~hp, data = mtcars),
        feols(mpg ~  cyl | gear + carb + am, cluster = ~hp, data = mtcars)),
    "Panel B: Displacement" = list(
        feols(disp ~ cyl | gear + carb, cluster = ~hp, data = mtcars),
        feols(disp ~ cyl | gear + carb + am, cluster = ~hp, data = mtcars))
)
```

    

```{r}
glance_custom.fixest <- function(x, ...) {
    data.table::data.table(`Mean of DV` = mean(insight::get_response(x)))
}

panels <- list(
    "Panel A: MPG" = list(
        feols(mpg ~  cyl | gear + carb, cluster = ~hp, data = mtcars),
        feols(mpg ~  cyl | gear + carb + am, cluster = ~hp, data = mtcars)),
    "Panel B: Displacement" = list(
        feols(disp ~ cyl | gear + carb, cluster = ~hp, data = mtcars),
        feols(disp ~ cyl | gear + carb + am, cluster = ~hp, data = mtcars))
)

panelsummary(
    panels,
    title = "Automated Mean of Dependent Variable",
    gof_map = c("nobs", "Mean of DV"))
```

# {fixest} + align

```{r}
f <- Sepal.Length ~ csw(Sepal.Width, Petal.Width)
panels <- list(
    Setosa = feols(f, data = subset(iris, Species == "setosa")),
    Virginica = feols(f, data = subset(iris, Species == "virginica")),
    Versicolor = feols(f, data = subset(iris, Species == "versicolor"))
)
gm <- c("vcov.type", "r.squared", "nobs", "FE: cyl")
panelsummary(
    panels,
    stars = TRUE,
    gof_map = gm)
```

# lm() + lmer() + {kableExtra}

```{r}
panels <- list(
    "Ordinary Least Squares" = list(
        lm(Sepal.Length ~ Sepal.Width, data = iris),
        lm(Sepal.Length ~ Sepal.Width + Petal.Width, data = iris)),
    "Mixed Effects" = list(
        lmer(Sepal.Length ~ Sepal.Width + (1 | Species), data = iris),
        lmer(Sepal.Length ~ Sepal.Width + Petal.Width + (1 | Species), data = iris))
)
panelsummary(panels, gof_map = c("aic", "nobs"))
```

# Non-matching model names

```{r}
panels <- list(
    "Ordinary Least Squares" = list(
        "A" = lm(Sepal.Length ~ Sepal.Width, data = iris),
        "B" = lm(Sepal.Length ~ Sepal.Width + Petal.Width, data = iris)),
    "Mixed Effects" = list(
        "A" = lmer(Sepal.Length ~ Sepal.Width + (1 | Species), data = iris),
        "C" = lmer(Sepal.Length ~ Sepal.Width + Petal.Width + (1 | Species), data = iris))
)
panelsummary(panels, gof_map = c("aic", "nobs"))
```

# No GOF at all

```{r}
panelsummary(panels, gof_map = NA)
```

# Rmarkdown example

````
---
output: pdf_document
---

```{r}
#| eval = FALSE

library("fixest")
library("modelsummary")
pkgload::load_all()


panels <- list(
    "Panel A: MPG" = list(
        feols(mpg ~  cyl | gear, cluster = ~hp, data = mtcars),
        feols(mpg ~  cyl + am | gear, cluster = ~hp, data = mtcars)),
    "Panel B: Displacement" = list(
        feols(disp ~ cyl | gear, cluster = ~hp, data = mtcars),
        feols(disp ~ cyl + am | gear, cluster = ~hp, data = mtcars))
)
panelsummary(panels, gof_map = c("nobs", "r.squared"))
```
````